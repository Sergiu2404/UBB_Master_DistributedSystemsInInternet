# JPA Basics

This document covers the Java Persistence API (JPA), providing a detailed overview of its concepts, annotations, and
several examples to illustrate how JPA operates in Java applications.

## Table of Contents

- [What is JPA?](#what-is-jpa)
- [Key Concepts of JPA](#key-concepts-of-jpa)
    - [Entities](#entities)
    - [Entity Manager](#entity-manager)
    - [Persistence Context](#persistence-context)
    - [JPQL (Java Persistence Query Language)](#jpql-java-persistence-query-language)
- [Basic Annotations in JPA](#basic-annotations-in-jpa)
- [Examples](#examples)
    - [Example 1: Defining an Entity](#example-1-defining-an-entity)
    - [Example 2: Persisting an Entity](#example-2-persisting-an-entity)
    - [Example 3: Finding an Entity by ID](#example-3-finding-an-entity-by-id)
    - [Example 4: Updating an Entity](#example-4-updating-an-entity)
    - [Example 5: Removing an Entity](#example-5-removing-an-entity)
    - [Example 6: Using JPQL to Query Entities](#example-6-using-jpql-to-query-entities)
    - [Example 7: Using Criteria API for Dynamic Queries](#example-7-using-criteria-api-for-dynamic-queries)
    - [Example 8: Relationships with @OneToMany](#example-8-relationships-with-onetomany)
- [Bibliography](#bibliography)

---

## What is JPA?

Java Persistence API (JPA) is a standard for mapping Java objects to relational database tables. JPA offers an
abstraction for database interactions, providing a set of annotations and methods for managing, querying, and persisting
data using object-relational mapping (ORM). It is commonly used with Hibernate, EclipseLink, or other ORM frameworks.

---

## Key Concepts of JPA

### Entities

An **entity** represents a table in a relational database. Each instance of an entity corresponds to a row in the table.

### Entity Manager

The **Entity Manager** is the API for creating, reading, updating, and deleting entities.

### Persistence Context

The **persistence context** is the environment that tracks the state of entities managed by an Entity Manager.

### JPQL (Java Persistence Query Language)

**JPQL** is a query language that operates on entity objects instead of directly on database tables, similar to SQL but
tailored for object-oriented operations.

---

## Basic Annotations in JPA

- **@Entity**: Marks a class as an entity.
- **@Id**: Declares the primary key of an entity.
- **@GeneratedValue**: Configures the automatic generation of the primary key.
- **@Table**: Maps the entity to a specific table.
- **@Column**: Maps a field to a database column.

---

## Examples

### Example 1: Defining an Entity

```java
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Column;
import javax.persistence.Table;

@Entity
@Table(name = "articles")
public class Article {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "title", nullable = false)
    private String title;

    @Column(name = "content")
    private String content;

    // Getters and setters...
}
```

### Example 2: Persisting an Entity

```java
import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;

public class ArticleService {
    private EntityManagerFactory emf = Persistence.createEntityManagerFactory("examplePU");

    public void addArticle(String title, String content) {
        EntityManager em = emf.createEntityManager();
        em.getTransaction().begin();
        Article article = new Article();
        article.setTitle(title);
        article.setContent(content);
        em.persist(article);
        em.getTransaction().commit();
        em.close();
    }
}

```

### Example 3: Finding an Entity by ID

```java
public Article findArticle(Long id){
        EntityManager em=emf.createEntityManager();
        Article article=em.find(Article.class,id);
        em.close();
        return article;
        }

```

### Example 4: Updating an Entity
```java
public void updateArticle(Long id, String newContent) {
      EntityManager em = emf.createEntityManager();
      em.getTransaction().begin();
      Article article = em.find(Article.class, id);
      if (article != null) {
      article.setContent(newContent);
      }
      em.getTransaction().commit();
      em.close();
}

```

### Example 5: Removing an Entity

```java
public void deleteArticle(Long id) {
    EntityManager em = emf.createEntityManager();
    em.getTransaction().begin();
    Article article = em.find(Article.class, id);
    if (article != null) {
        em.remove(article);
    }
    em.getTransaction().commit();
    em.close();
}

```

### Example 6: Using JPQL to Query Entities
```java
import javax.persistence.TypedQuery;

public List<Article> getArticlesByTitle(String title) {
    EntityManager em = emf.createEntityManager();
    TypedQuery<Article> query = em.createQuery("SELECT a FROM Article a WHERE a.title = :title", Article.class);
    query.setParameter("title", title);
    List<Article> articles = query.getResultList();
    em.close();
    return articles;
}

```


### Example 7: Using Criteria API for Dynamic Queries
```java
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Root;

public List<Article> findArticlesWithCriteria(String title) {
    EntityManager em = emf.createEntityManager();
    CriteriaBuilder cb = em.getCriteriaBuilder();
    CriteriaQuery<Article> cq = cb.createQuery(Article.class);
    Root<Article> article = cq.from(Article.class);
    cq.select(article).where(cb.equal(article.get("title"), title));
    List<Article> articles = em.createQuery(cq).getResultList();
    em.close();
    return articles;
}

```

### Example 8: Relationships with @OneToMany
```java
import javax.persistence.*;
import java.util.List;

@Entity
public class Author {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @OneToMany(mappedBy = "author", cascade = CascadeType.ALL)
    private List<Article> articles;

    // Getters and setters...
}

```

In this example, an Author entity is associated with multiple Article entities through a one-to-many relationship.


## Bibliography
- Pro JPA 2 in Java EE 8: An In-Depth Guide to Java Persistence APIs by Mike Keith and Merrick Schincariol.
- Java Persistence with Hibernate by Christian Bauer, Gavin King, and Gary Gregory.
- Official JPA Documentation - Oracle Java EE Documentation.
- Effective Java by Joshua Bloch (for best practices, though not specific to JPA). 
